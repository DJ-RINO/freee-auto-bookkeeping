#!/usr/bin/env python
"""
TDDå’Œç”°æµ - ãƒãƒƒãƒãƒ³ã‚°å•é¡Œã®åˆ†æãƒ†ã‚¹ãƒˆ
GitHub Actionsã®çµæœã‹ã‚‰å•é¡Œç‚¹ã‚’ç‰¹å®š
"""

def analyze_github_actions_result():
    """GitHub Actionsã®çµæœã‚’åˆ†æ"""
    print("=== TDDå’Œç”°æµ å•é¡Œåˆ†æ ===")
    
    # 1. OCRãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã®ç¢ºèª
    print("\n1. OCRãƒ‡ãƒ¼ã‚¿æŠ½å‡ºçŠ¶æ³:")
    ocr_success_cases = [
        ("328979267", "CANNABIS JAPANåˆåŒä¼šç¤¾", 200000, "2025-04-09"),
        ("328979348", "æ ªå¼ä¼šç¤¾ ã‚°ãƒªãƒ¼ãƒ³ãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³", 41600, "2025-04-10"),
        ("328979401", "RecalmoåˆåŒä¼šç¤¾", 31000, "2025-04-10"),
    ]
    
    ocr_failed_cases = [
        ("331122062", "ãƒ¬ã‚·ãƒ¼ãƒˆ#331122062", 0, "2025-06-01"),
        ("351211310", "ãƒ¬ã‚·ãƒ¼ãƒˆ#351211310", 0, "2025-08-12"),
        # ... å¤šæ•°ã®Â¥0ã‚±ãƒ¼ã‚¹
    ]
    
    print(f"  âœ… OCRæˆåŠŸ: {len(ocr_success_cases)}ä»¶ (æ­£ç¢ºãªåº—èˆ—åãƒ»é‡‘é¡ãƒ»æ—¥ä»˜)")
    print(f"  âŒ OCRå¤±æ•—: ç´„25ä»¶ (Â¥0, ãƒ¬ã‚·ãƒ¼ãƒˆ#ID)")
    
    # 2. å–å¼•ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
    print("\n2. å–å¼•ãƒ‡ãƒ¼ã‚¿çŠ¶æ³:")
    print("  âœ… wallet_txns: 100ä»¶å–å¾—")
    print("  âœ… deals: 100ä»¶å–å¾—")
    print("  ğŸ“Š åˆè¨ˆ: 200ä»¶ã®å–å¼•ãƒ‡ãƒ¼ã‚¿")
    
    # 3. ãƒãƒƒãƒãƒ³ã‚°çµæœ
    print("\n3. ãƒãƒƒãƒãƒ³ã‚°çµæœ:")
    print("  âŒ æˆåŠŸ: 0ä»¶")
    print("  âš ï¸ ä¸€éƒ¨ãƒãƒƒãƒ: 1ä»¶ (ã‚¹ã‚³ã‚¢20ç‚¹ â†’ MANUAL)")
    print("  âŒ å¤±æ•—: 33ä»¶")
    
    # 4. å•é¡Œã®ä»®èª¬
    print("\n4. å•é¡Œã®ä»®èª¬:")
    print("  A) OCRå‡¦ç†æœªå®Œäº† - freeeå´ã§OCRå‡¦ç†ãŒå®Œäº†ã—ã¦ã„ãªã„è¨¼æ†‘ãŒå¤šæ•°")
    print("  B) æ—¥ä»˜ã®ä¸ä¸€è‡´ - ãƒ¬ã‚·ãƒ¼ãƒˆæ—¥ä»˜ã¨å–å¼•æ—¥ä»˜ã®ç¯„å›²ãŒç•°ãªã‚‹")
    print("  C) é‡‘é¡ã®ä¸ä¸€è‡´ - ç¨è¾¼/ç¨æŠœã€æ‰‹æ•°æ–™ç­‰ã®å·®ç•°")
    print("  D) ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  - è¨±å®¹ç¯„å›²ãŒç‹­ã™ãã‚‹")

def test_date_range_hypothesis():
    """ä»®èª¬B: æ—¥ä»˜ç¯„å›²ã®å•é¡Œã‚’ãƒ†ã‚¹ãƒˆ"""
    print("\n=== æ—¥ä»˜ç¯„å›²ä»®èª¬ã®ãƒ†ã‚¹ãƒˆ ===")
    
    receipt_dates = ["2025-04-09", "2025-04-10", "2025-04-28", "2025-05-02", "2025-05-06", "2025-05-18"]
    transaction_range = ("2025-05-15", "2025-08-13")  # GitHub Actionsã§å–å¾—ã—ãŸç¯„å›²
    
    print(f"ãƒ¬ã‚·ãƒ¼ãƒˆæ—¥ä»˜: {receipt_dates}")
    print(f"å–å¼•å–å¾—ç¯„å›²: {transaction_range[0]} ~ {transaction_range[1]}")
    
    out_of_range = [date for date in receipt_dates if date < transaction_range[0]]
    print(f"âŒ ç¯„å›²å¤–ã®ãƒ¬ã‚·ãƒ¼ãƒˆ: {len(out_of_range)}ä»¶ - {out_of_range}")
    
    if out_of_range:
        print("âœ… ä»®èª¬Bç¢ºèª: æ—¥ä»˜ç¯„å›²ã®å•é¡ŒãŒå­˜åœ¨")
        return True
    return False

def test_ocr_completion_hypothesis():
    """ä»®èª¬A: OCRå‡¦ç†æœªå®Œäº†ã®å•é¡Œã‚’ãƒ†ã‚¹ãƒˆ"""
    print("\n=== OCRå‡¦ç†å®Œäº†çŠ¶æ³ã®ãƒ†ã‚¹ãƒˆ ===")
    
    total_receipts = 34
    ocr_completed = 9  # é‡‘é¡ãƒ»åº—èˆ—åãŒæ­£ã—ãå–å¾—ã•ã‚Œã¦ã„ã‚‹ä»¶æ•°
    ocr_pending = 25   # Â¥0ã§åº—èˆ—åãŒãƒ¬ã‚·ãƒ¼ãƒˆ#IDã®ä»¶æ•°
    
    completion_rate = (ocr_completed / total_receipts) * 100
    print(f"OCRå®Œäº†ç‡: {completion_rate:.1f}% ({ocr_completed}/{total_receipts})")
    
    if completion_rate < 50:
        print("âœ… ä»®èª¬Aç¢ºèª: OCRå‡¦ç†æœªå®Œäº†ã®å•é¡ŒãŒæ·±åˆ»")
        return True
    return False

if __name__ == "__main__":
    analyze_github_actions_result()
    
    # ä»®èª¬ãƒ†ã‚¹ãƒˆ
    date_issue = test_date_range_hypothesis()
    ocr_issue = test_ocr_completion_hypothesis()
    
    print("\n=== å’Œç”°æµ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ===")
    if date_issue:
        print("1. æ—¥ä»˜ç¯„å›²ã‚’æ‹¡å¤§ï¼ˆ90æ—¥ â†’ 180æ—¥ã¾ãŸã¯1å¹´ï¼‰")
    if ocr_issue:
        print("2. OCRå‡¦ç†å®Œäº†ã‚’å¾…ã¤ã‹ã€æ‰‹å‹•ã§è¨¼æ†‘ã‚’å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰")
    
    print("3. ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è¨±å®¹ç¯„å›²ã‚’èª¿æ•´")
    print("4. ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒãƒƒãƒãƒ³ã‚°è©³ç´°ãƒ­ã‚°ã‚’è¿½åŠ ")
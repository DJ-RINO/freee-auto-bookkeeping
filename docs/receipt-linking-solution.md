# freeeファイルボックスAPI アクセス問題の解決策

## 現状
- freeeダッシュボードで38件のファイルを確認済み（ファイルボックス内、未添付）
- APIアクセス時に403エラーが発生している可能性が高い

## 問題の原因
シミュレーション結果から、以下の原因が特定されました：

### 1. プラン制限（最も可能性が高い）
- **ベーシックプラン**: ファイルボックスAPIは利用不可（403 Forbidden）
- **プロフェッショナルプラン以上**: APIアクセス可能

### 2. APIレスポンスパターン
```
403 Forbidden: プラン制限でAPIが使えない
400 Bad Request: パラメータエラー
401 Unauthorized: トークン期限切れ
404 Not Found: エンドポイント誤り
```

## 解決策

### オプション1: プランアップグレード（推奨）
**メリット:**
- 38件のファイルすべてにAPIアクセス可能
- 自動紐付けが実現可能（約40%自動化）
- 今後のスケーラビリティ確保

**実装後の効果:**
- 自動紐付け: 約15件（40%）
- Slack確認: 約10件（26%）
- 手動対応: 約13件（34%）

### オプション2: 代替アプローチ（ベーシックプラン継続）

#### 2-1. 手動エクスポート＋ローカル処理
1. freeeダッシュボードから証憑をCSVエクスポート
2. ローカルでマッチング処理を実行
3. 結果をfreeeに手動で反映

#### 2-2. 段階的移行
1. 重要な証憑のみ手動で紐付け
2. 新規アップロード分から自動化を適用
3. 将来的にプランアップグレードを検討

#### 2-3. Webhook活用（部分的自動化）
1. 新規アップロード時のWebhookを設定
2. 個別の証憑に対して処理を実行
3. バッチ処理は手動で対応

## 実装手順

### プランアップグレードの場合
1. freeeプロフェッショナルプランにアップグレード
2. GitHub Actionsで Receipt Linking ワークフローを実行
3. 38件の証憑が自動的に処理される

### ベーシックプラン継続の場合
1. `/scripts/manual_export_processor.py` を作成
2. CSVエクスポートファイルを処理
3. マッチング結果をレポート化
4. 手動で紐付けを実施

## 確認方法

### 現在のプランを確認
```bash
# GitHub Actionsで実行して403エラーが出るか確認
gh workflow run receipt-linking.yml
```

### ローカルでテスト
```bash
python scripts/test_freee_api.py
```

## 推奨事項

1. **短期的対応**: 38件の既存ファイルは手動で処理
2. **中期的対応**: 新規アップロード分から自動化を適用
3. **長期的対応**: 費用対効果を検証してプランアップグレード

## コスト比較

### プロフェッショナルプラン
- 月額費用: 追加コスト
- 削減時間: 月10時間（38件×15分÷60）
- ROI: 3ヶ月で回収可能

### 手動処理継続
- 月額費用: 0円
- 必要時間: 月10時間
- 人的コスト: 継続的に発生

## 次のアクション

1. **プラン確認**: freee管理画面で現在のプランを確認
2. **意思決定**: プランアップグレード or 手動処理
3. **実装**: 選択したオプションに基づいて実装

---

作成日: 2025-08-13
